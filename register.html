<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Access - xlordcode</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="shortcut icon" type="image/png" href="logoku.PNG" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.css">
    <style>
    :root {
        --bg-color: #2c2f36; --shadow-dark: #202227; --shadow-light: #383c45;
        --text-color: #d1d5db; --text-light: #8a91a0; --primary: #5a7dff;
        --primary-dark: #4a6fe0; --success: #28a745; --error: #dc3545;
        --warning: #ffc107; --pink: #ff69b4; --transition-smooth: all 0.3s ease-in-out;
        --border-radius-main: 30px; --border-radius-inner: 15px;
    }
    
    /* --- ANIMASI BARU --- */
    @keyframes zoomInEffect { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-user-select: none; user-select: none; }
    body { background: var(--bg-color); min-height: 100vh; display: flex; justify-content: center; align-items: center; color: var(--text-color); padding: 20px; }
    textarea, input { touch-action: auto; -webkit-user-select: text; user-select: text; }
    
    .main-container { width: 100%; max-width: 1200px; display: flex; justify-content: center; align-items: center; }
    #auth-container { width: 100%; max-width: 440px; transition: max-width 0.8s ease, min-height 0.8s ease; }
    #auth-container.is-active { max-width: 1100px; min-height: 95vh; }
    
    /* --- PENERAPAN ANIMASI BARU --- */
    .box { background: var(--bg-color); border-radius: var(--border-radius-main); box-shadow: 12px 12px 24px var(--shadow-dark), -12px -12px 24px var(--shadow-light); padding: 40px; width: 100%; display: flex; flex-direction: column; animation: zoomInEffect 0.6s ease-out; }
    #adminPanelBox { display: none; }
    #auth-container.is-active #auth-box { display: none; }
    #auth-container.is-active #adminPanelBox { display: flex; flex-direction: column; width: 100%; height: 95vh; animation: zoomInEffect 0.6s ease-out; padding: 30px; }

    .brand-header { text-align: center; margin-bottom: 30px; }
    .brand-header img { width: 50px; height: 50px; border-radius: 12px; margin: 0 auto 16px; display: block; }
    .brand-header h1 { font-size: 1.8rem; font-weight: 700; color: var(--text-color); margin-bottom: 4px; }
    .brand-header p { color: var(--text-light); font-size: 1rem; }
    
    .tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    .tab-button { background: var(--bg-color); border: none; border-radius: var(--border-radius-inner); padding: 16px; font-size: 1rem; font-weight: 600; color: var(--text-light); cursor: pointer; transition: var(--transition-smooth); box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); }
    .tab-button.active { color: var(--primary); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); }
    
    .input-group { margin-bottom: 25px; text-align: left; }
    .input-group label { display: block; color: var(--text-light); font-size: 0.9rem; font-weight: 500; margin-bottom: 12px; padding-left: 10px; }
    .input-wrapper { position: relative; }
    
    .input-field { 
        width: 100%; padding: 18px 22px 18px 55px; background: var(--bg-color); border: none; 
        border-radius: var(--border-radius-inner); color: var(--text-color); font-size: 1rem; 
        box-shadow: inset 7px 7px 15px var(--shadow-dark), inset -7px -7px 15px var(--shadow-light); 
        transition: var(--transition-smooth);
        -webkit-appearance: none; -moz-appearance: none; appearance: none;
    }
    
    .input-field:focus { outline: none; box-shadow: inset 9px 9px 18px var(--shadow-dark), inset -9px -9px 18px var(--shadow-light), 0 0 0 2px var(--primary); }
    .input-wrapper .icon-left, .input-wrapper .icon-right { position: absolute; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 16px; pointer-events: none; }
    .input-wrapper .icon-left { left: 22px; }
    .input-wrapper .icon-right { right: 22px; cursor: pointer; pointer-events: auto; }
    .input-field:focus ~ .icon-left { color: var(--primary); }
    textarea.input-field { padding: 18px 22px; }
    
    .btn-primary { width: 100%; padding: 18px; background: var(--bg-color); border: none; border-radius: var(--border-radius-inner); color: var(--primary); font-size: 1.05rem; font-weight: 600; cursor: pointer; transition: var(--transition-smooth); box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-2px); color: var(--primary-dark); }
    .btn-primary:disabled { opacity: 0.7; }
    
    #register-form-content { display: none; }
    
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid var(--shadow-light); flex-shrink: 0; }
    .panel-header h1 { margin-bottom: 0; font-size: 1.8rem; }
    .panel-form { flex-grow: 1; overflow-y: auto; overflow-x: hidden; padding: 10px 5px; scrollbar-width: thin; scrollbar-color: var(--primary) var(--shadow-dark); }
    .panel-form::-webkit-scrollbar { width: 8px; }
    .panel-form::-webkit-scrollbar-track { background: var(--shadow-dark); border-radius: 10px; }
    .panel-form::-webkit-scrollbar-thumb { background-color: var(--primary); border-radius: 10px; border: 2px solid var(--shadow-dark); }
    .panel-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; padding-right: 15px; }
    .layout-column { display: flex; flex-direction: column; gap: 30px; }
    .panel-section { background: var(--bg-color); border-radius: 20px; padding: 30px; box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); }
    .section-title { display: flex; align-items: center; gap: 15px; font-size: 1.3rem; font-weight: 600; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid var(--shadow-light); }
    .section-title i { color: var(--primary); }
    .panel-actions { display: flex; justify-content: space-between; align-items: center; padding-top: 30px; margin-top: auto; flex-shrink: 0; }
    .btn { padding: 16px; border: none; background: var(--bg-color); border-radius: var(--border-radius-inner); cursor: pointer; font-weight: 600; box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); transition: var(--transition-smooth); display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
    .btn-save { color: var(--success); }
    .btn-logout { color: var(--error); }
    .qr-preview-image { max-width: 150px; border-radius: var(--border-radius-inner); display: none; margin-top: 15px; background: var(--bg-color); padding: 8px; box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light); }
    #puzzleWord1, #puzzleWord2, #puzzleWord3 { text-transform: uppercase; }
    @media (max-width: 991px) { .panel-layout { display: flex; flex-direction: column; padding-right: 0; } .panel-actions { flex-direction: column-reverse; align-items: stretch; gap: 15px; } .btn { width: 100%; } }
    
    .support-section { margin-top: 40px; padding-top: 25px; border-top: 1px solid var(--shadow-dark); text-align: center; }
    .support-title { font-size: 0.9rem; color: var(--text-light); margin-bottom: 20px; }
    .social-icons { display: flex; justify-content: center; gap: 25px; }
    .social-icons a { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; text-decoration: none; background: var(--bg-color); color: var(--text-light); border-radius: 50%; font-size: 1.2rem; box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); }
    .social-icons a:hover { color: var(--pink); }

    .swal2-popup { background-color: var(--bg-color) !important; color: var(--text-color) !important; border-radius: var(--border-radius-main) !important; box-shadow: 12px 12px 24px var(--shadow-dark), -12px -12px 24px var(--shadow-light) !important; }
    .swal2-title { color: var(--text-color) !important; }
    .swal2-html-container { color: var(--text-light) !important; }
    .swal2-confirm, .swal2-cancel, .swal2-deny { box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light) !important; border: none !important; display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600 !important; padding: 10px 20px !important; }
    .swal2-confirm { background-color: var(--bg-color) !important; color: var(--primary) !important; }
    .swal2-cancel { background-color: var(--bg-color) !important; color: var(--text-light) !important; }
    .swal2-deny { background-color: var(--bg-color) !important; color: var(--warning) !important; }
    </style>
</head>
<body>
    <div id="auth-container">
        <div class="box" id="auth-box">
            <div class="brand-header">
                <img src="/logoku.png" alt="XlordCode Logo">
                <h1>Welcome to XlordCode</h1>
                <p>Sign in to your account to continue</p>
            </div>
            
            <div class="tabs">
                <button class="tab-button active" id="login-tab-btn">Login</button>
                <button class="tab-button" id="register-tab-btn">Register</button>
            </div>

            <div id="login-form-content">
                <div class="input-group"><label>Username</label><div class="input-wrapper"><i class="fas fa-user icon-left"></i><input type="text" id="adminUser" class="input-field" placeholder="Username Anda"></div></div>
                <div class="input-group"><label>Password</label><div class="input-wrapper"><i class="fas fa-key icon-left"></i><input type="password" id="adminPass" class="input-field" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"><i class="fas fa-eye-slash icon-right" onclick="togglePasswordVisibility('adminPass', this)"></i></div></div>
            </div>

            <div id="register-form-content">
                <div class="input-group"><label for="registerAdminName">Username</label><div class="input-wrapper"><i class="fas fa-user icon-left"></i><input type="text" id="registerAdminName" class="input-field" placeholder="Pilih username unik" required></div></div>
                <div class="input-group"><label for="registerAdminPass">Password</label><div class="input-wrapper"><i class="fas fa-key icon-left"></i><input type="password" id="registerAdminPass" class="input-field" placeholder="Minimal 3 karakter" required><i class="fas fa-eye-slash icon-right" onclick="togglePasswordVisibility('registerAdminPass', this)"></i></div></div>
                <div class="input-group"><label for="repeatPass">Ulangi Password</label><div class="input-wrapper"><i class="fas fa-key icon-left"></i><input type="password" id="repeatPass" class="input-field" placeholder="Ketik ulang password" required><i class="fas fa-eye-slash icon-right" onclick="togglePasswordVisibility('repeatPass', this)"></i></div></div>
            </div>

            <button class="btn-primary" id="main-action-btn"><i class="fas fa-sign-in-alt"></i> Masuk</button>
            
            <div class="support-section">
                <p class="support-title">Support Me</p>
                <div class="social-icons">
                    <a href="https://instagram.com/off.xlord" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="https://github.com/your-github" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
                    <a href="https://www.tiktok.com/@xlordduyy" target="_blank" title="TikTok"><i class="fab fa-tiktok"></i></a>
                </div>
            </div>
        </div>
        
        <div class="box" id="adminPanelBox">
            <div class="panel-header"><h1><i class="fas fa-cogs"></i> Setting Panel</h1></div>
            <form id="editForm" onsubmit="event.preventDefault(); saveData();" class="panel-form">
                <div class="panel-layout">
                    <div class="layout-column">
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-birthday-cake"></i><span>Info Utama</span></div>
                            <div class="input-group"><label for="birthdayNameInput">Nama</label><div class="input-wrapper"><i class="fas fa-user-edit icon-left"></i><input type="text" id="birthdayNameInput" class="input-field" required></div></div>
                            <div class="input-group"><label for="birthDateInput">Tanggal Lahir</label><div class="input-wrapper"><i class="fas fa-calendar-alt icon-left"></i><input type="date" id="birthDateInput" class="input-field" required></div></div>
                            <div class="input-group"><label for="bestWishesInput">Harapan Terbaik</label><div class="input-wrapper"><textarea id="bestWishesInput" class="input-field" rows="4" placeholder="Masukkan harapan terbaik..."></textarea></div></div>
                            <div class="input-group"><label for="stayStrongQuoteInput">Kesan atau quotes</label><div class="input-wrapper"><textarea id="stayStrongQuoteInput" class="input-field" rows="3" placeholder="Masukkan quote..."></textarea></div></div>
                        </div>
                        <div class="panel-section">
                             <div class="section-title"><i class="fas fa-users"></i><span>Akses Tamu</span></div>
                             <div class="input-group"><label for="guestUserInput">Username Tamu</label><div class="input-wrapper"><i class="fas fa-user icon-left"></i><input type="text" id="guestUserInput" class="input-field" required></div></div>
                             <div class="input-group"><label for="guestPassInput">Password Tamu</label><div class="input-wrapper"><i class="fas fa-lock icon-left"></i><input type="text" id="guestPassInput" class="input-field" required></div></div>
                             <div class="input-group"><label for="targetWhatsappNumber">Nomor WhatsApp Target</label><div class="input-wrapper"><i class="fab fa-whatsapp icon-left"></i><input type="tel" id="targetWhatsappNumber" class="input-field" placeholder="6281xxxxxxxx"></div></div>
                        </div>
                    </div>
                    <div class="layout-column">
                        <div class="panel-section"><div class="section-title"><i class="fas fa-share-alt"></i><span>Link Publik</span></div><div class="input-group"><label for="shareableLink">Bagikan link ini</label><div class="input-wrapper"><i class="fas fa-link icon-left"></i><input type="text" id="shareableLink" class="input-field" readonly><i class="fas fa-copy icon-right" id="copyLinkBtn" title="Salin Link"></i></div></div></div>
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-puzzle-piece"></i><span>Setting Game Kata</span></div>
                            <div class="input-group"><label for="puzzleWord1">Kata Tersembunyi 1</label><div class="input-wrapper"><i class="fas fa-font icon-left"></i><input type="text" id="puzzleWord1" class="input-field" placeholder="Contoh: ULTAH" maxlength="8" required></div></div>
                            <div class="input-group"><label for="puzzleWord2">Kata Tersembunyi 2</label><div class="input-wrapper"><i class="fas fa-font icon-left"></i><input type="text" id="puzzleWord2" class="input-field" placeholder="Contoh: KADO" maxlength="8" required></div></div>
                            <div class="input-group"><label for="puzzleWord3">Kata Tersembunyi 3</label><div class="input-wrapper"><i class="fas fa-font icon-left"></i><input type="text" id="puzzleWord3" class="input-field" placeholder="Contoh: DOA" maxlength="8" required></div></div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-qrcode"></i><span>Kode QR</span></div>
                            <div class="input-group"><label for="qrImageUrlInput">URL Gambar QR</label><div class="input-wrapper"><i class="fas fa-image icon-left"></i><input type="url" id="qrImageUrlInput" class="input-field" placeholder="https://..." required></div></div>
                            <img id="qrPreviewImage" class="qr-preview-image" src="" alt="Pratinjau QR">
                            <div class="input-group" style="margin-top: 20px;"><label for="qrMessageInput">Pesan di bawah QR</label><div class="input-wrapper"><textarea id="qrMessageInput" class="input-field" rows="3" placeholder="Masukkan pesan di bawah QR code..."></textarea></div></div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="panel-actions">
                <button class="btn btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Log Out</button>
                <button type="submit" form="editForm" class="btn btn-save"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>
    <script>
    const firebaseConfig = { apiKey: "GANTI_DENGAN_API_KEY_ANDA", authDomain: "mayfa-fa284.firebaseapp.com", databaseURL: "https://mayfa-fa284-default-rtdb.asia-southeast1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const authContainer = document.getElementById('auth-container');
    const loginTabBtn = document.getElementById('login-tab-btn');
    const registerTabBtn = document.getElementById('register-tab-btn');
    const loginFormContent = document.getElementById('login-form-content');
    const registerFormContent = document.getElementById('register-form-content');
    const mainActionBtn = document.getElementById('main-action-btn');
    let currentAdminId = null;

    function showLoginView() {
        loginTabBtn.classList.add('active');
        registerTabBtn.classList.remove('active');
        loginFormContent.style.display = 'block';
        registerFormContent.style.display = 'none';
        mainActionBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Masuk';
    }

    function showRegisterView() {
        registerTabBtn.classList.add('active');
        loginTabBtn.classList.remove('active');
        registerFormContent.style.display = 'block';
        loginFormContent.style.display = 'none';
        mainActionBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Daftar Sekarang';
    }

    function adminLogin() {
        const user = document.getElementById('adminUser').value.trim();
        const pass = document.getElementById('adminPass').value;
        if (!user || !pass) return Swal.fire('Input Diperlukan', 'Username dan password harus diisi.', 'warning');
        
        mainActionBtn.disabled = true;
        Swal.fire({
            title: 'Sedang memverifikasi data..', text: 'Mohon tunggu ya.',
            allowOutsideClick: false,
            didOpen: () => { Swal.showLoading(); }
        });

        database.ref('admins').orderByChild('username').equalTo(user).once('value').then(s => {
            if (!s.exists()) throw new Error('Username atau password salah.');
            let isValid = false, adminName = '';
            s.forEach(cs => { 
                if (cs.val().password === pass) { 
                    isValid = true; 
                    currentAdminId = cs.key; 
                    adminName = cs.val().username; 
                } 
            });

            if (isValid) {
                Swal.close(); // Tutup loading dialog
                authContainer.classList.add('is-active');
                loadDataToForm(adminName); // Kirim nama admin ke fungsi load
            } else { 
                throw new Error('Username atau password salah.'); 
            }
        }).catch(err => {
            Swal.fire('Login Gagal', err.message, 'error');
            mainActionBtn.disabled = false;
        });
    }

    function createAccount() {
        const adminName = document.getElementById('registerAdminName').value.trim();
        const adminPass = document.getElementById('registerAdminPass').value;
        const repeatPass = document.getElementById('repeatPass').value;
        if (!adminName || !adminPass || !repeatPass) return Swal.fire('Input Tidak Lengkap', 'Semua kolom wajib diisi.', 'warning');
        if (adminPass !== repeatPass) return Swal.fire('Password Tidak Cocok', 'Password dan Ulangi Password tidak sama.', 'error');

        mainActionBtn.disabled = true; mainActionBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        database.ref('admins').orderByChild('username').equalTo(adminName).once('value', snapshot => {
            if (snapshot.exists()) {
                Swal.fire('Username Sudah Ada', 'Silakan pilih username lain.', 'error');
                mainActionBtn.disabled = false; mainActionBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Daftar Sekarang';
            } else {
                const newAdminRef = database.ref('admins').push();
                newAdminRef.set({ username: adminName, password: adminPass })
                .then(() => {
                    const defaultData = { birthdayName: adminName, birthDate: "2005-09-28" };
                    return database.ref('birthday_pages/' + newAdminRef.key).set(defaultData);
                })
                .then(() => {
                    Swal.fire('Berhasil!', 'Akun Anda telah dibuat. Silakan login.', 'success');
                    showLoginView();
                })
                .catch(err => Swal.fire('Gagal', err.message, 'error'))
                .finally(() => { mainActionBtn.disabled = false; mainActionBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Daftar Sekarang'; });
            }
        });
    }

    function logout() {
        Swal.fire({
            title: 'Konfirmasi Log Out', text: 'Anda yakin ingin keluar dari setting panel?', icon: 'question', 
            showCancelButton: true, confirmButtonText: 'Ya, Log Out', cancelButtonText: 'Batal', reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                currentAdminId = null;
                authContainer.classList.remove('is-active');
                document.getElementById('adminUser').value = '';
                document.getElementById('adminPass').value = '';
                updateQrPreview();
            }
        });
    }

    // --- FUNGSI DIUBAH UNTUK MENAMPILKAN NOTIFIKASI ---
    function loadDataToForm(adminName = '') {
        if (!currentAdminId) return;

        // Tampilkan notifikasi selamat datang jika nama admin tersedia
        if (adminName) {
            Swal.fire({
                icon: 'success', title: `Selamat datang, ${adminName}!`,
                toast: true, position: 'top-end', showConfirmButton: false,
                timer: 3000, timerProgressBar: true
            });
        }
        
        mainActionBtn.disabled = false;
        mainActionBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Masuk';

        database.ref('birthday_pages/' + currentAdminId).once('value').then(s => {
            const data = s.val() || {};
            document.getElementById('birthdayNameInput').value = data.birthdayName || '';
            document.getElementById('birthDateInput').value = data.birthDate || '';
            document.getElementById('bestWishesInput').value = data.bestWishes || '';
            document.getElementById('stayStrongQuoteInput').value = data.stayStrongQuote || '';
            document.getElementById('guestUserInput').value = data.guestUser || '';
            document.getElementById('guestPassInput').value = data.guestPass || '';
            document.getElementById('targetWhatsappNumber').value = data.targetWhatsappNumber || '';
            document.getElementById('shareableLink').value = `${window.location.origin}/login.html?id=${currentAdminId}`;
            document.getElementById('puzzleWord1').value = data.puzzleWord1 || '';
            document.getElementById('puzzleWord2').value = data.puzzleWord2 || '';
            document.getElementById('puzzleWord3').value = data.puzzleWord3 || '';
            document.getElementById('qrImageUrlInput').value = data.qrImageUrl || '';
            document.getElementById('qrMessageInput').value = data.qrMessage || '';
            updateQrPreview();
        }).catch(err => Swal.fire('Gagal Memuat Data', err.message, 'error'));
    }

    function saveData() {
        if (!currentAdminId) return;
        const birthdayName = document.getElementById('birthdayNameInput').value, guestUser = document.getElementById('guestUserInput').value, guestPass = document.getElementById('guestPassInput').value, targetWhatsappNumber = document.getElementById('targetWhatsappNumber').value.trim();
        const settings = {
            birthdayName: birthdayName,
            birthDate: document.getElementById('birthDateInput').value,
            bestWishes: document.getElementById('bestWishesInput').value,
            stayStrongQuote: document.getElementById('stayStrongQuoteInput').value,
            guestUser: guestUser,
            guestPass: guestPass,
            targetWhatsappNumber: targetWhatsappNumber,
            puzzleWord1: document.getElementById('puzzleWord1').value.trim().toUpperCase(),
            puzzleWord2: document.getElementById('puzzleWord2').value.trim().toUpperCase(),
            puzzleWord3: document.getElementById('puzzleWord3').value.trim().toUpperCase(),
            qrImageUrl: document.getElementById('qrImageUrlInput').value,
            qrMessage: document.getElementById('qrMessageInput').value,
        };
        database.ref('birthday_pages/' + currentAdminId).set(settings).then(() => {
            const shareableLink = document.getElementById('shareableLink').value;
            const messageText = `Halo *${birthdayName}*! ðŸ‘‹\n\nKamu punya kejutan spesial! ðŸŽ‰ Sekarang kamu bisa mengakses halaman ulang tahunmu di link ini:\n\nðŸ”— *Link Halaman Ulang Tahun:*\n${shareableLink}\n\nUntuk masuk, gunakan detail berikut ya:\nðŸ‘¤ *Username:* ${guestUser}\nðŸ”‘ *Password:* ${guestPass}\n\n*Jangan lupa login, ada hadiah menunggumu!* âœ¨`.trim();
            Swal.fire({
                title: 'Data Berhasil Disimpan!', html: 'Pilih tindakan selanjutnya:', icon: 'success',
                showCancelButton: true, showDenyButton: true,
                confirmButtonText: '<i class="fab fa-whatsapp"></i> Kirim via WA',
                denyButtonText: '<i class="fas fa-copy"></i> Salin Info',
                cancelButtonText: 'Selesai', reverseButtons: true,
            }).then((result) => {
                if (result.isConfirmed) {
                    if (targetWhatsappNumber) { window.open(`https://wa.me/${targetWhatsappNumber}?text=${encodeURIComponent(messageText)}`, '_blank'); } 
                    else { Swal.fire({ icon: 'info', title: 'Nomor WhatsApp Kosong', text: 'Nomor WhatsApp target belum diisi.' }); }
                } else if (result.isDenied) {
                    navigator.clipboard.writeText(messageText).then(() => Swal.fire({ icon: 'success', title: 'Disalin!', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 }));
                }
            });
        }).catch(e => Swal.fire('Gagal Menyimpan', e.message, 'error'));
    }

    function updateQrPreview() {
        const qrInput = document.getElementById('qrImageUrlInput'), qrImage = document.getElementById('qrPreviewImage');
        try { new URL(qrInput.value.trim()); qrImage.src = qrInput.value.trim(); qrImage.style.display = 'block'; } 
        catch (e) { qrImage.style.display = 'none'; qrImage.src = ""; }
    }

    function togglePasswordVisibility(fieldId, icon) {
        const field = document.getElementById(fieldId);
        field.type = field.type === "password" ? "text" : "password";
        icon.classList.toggle('fa-eye'); icon.classList.toggle('fa-eye-slash');
    }
    
    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        loginTabBtn.addEventListener('click', showLoginView);
        registerTabBtn.addEventListener('click', showRegisterView);
        mainActionBtn.addEventListener('click', () => { loginTabBtn.classList.contains('active') ? adminLogin() : createAccount(); });
        document.getElementById('qrImageUrlInput').addEventListener('input', updateQrPreview);
        document.getElementById('copyLinkBtn').addEventListener('click', () => {
            const linkInput = document.getElementById('shareableLink');
            navigator.clipboard.writeText(linkInput.value).then(() => Swal.fire({ icon: 'success', title: 'Link Tersalin!', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 }));
        });
    });
    </script>
</body>
</html>