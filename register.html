<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Regist page</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="shortcut icon" type="image/png" href="IMG_1551.png" />
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.css">
    <style>
    :root {
        --bg-color: #242831;
        --shadow-dark: #1a1d25;
        --shadow-light: #2e333e;
        --text-color: #e0e0e0;
        --text-muted: #9e9e9e;
        --primary: #7a5dff;
        --primary-dark: #694fe2;
        --success: #28a745;
        --error: #dc3545;
        --pink: #ff69b4;
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        --radius-main: 25px;
        --radius-inner: 15px;
    }
    [data-theme="light"] {
        --bg-color: #f0f2f5;
        --shadow-dark: #d9dde2;
        --shadow-light: #ffffff;
        --text-color: #333333;
        --text-muted: #666666;
    }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body {
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        transition: var(--transition);
    }
    
    .theme-toggle { position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--bg-color); box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light); display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 100; transition: var(--transition); }
    .theme-toggle:hover { transform: scale(1.1); }
    .theme-toggle:active { box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); }
    .theme-toggle i { font-size: 1.2rem; color: var(--text-color); transition: var(--transition); }
    [data-theme="dark"] .fa-moon, [data-theme="light"] .fa-sun { display: none; }
    
    #auth-container {
        width: 100%;
        max-width: 960px;
        transition: all 0.6s ease;
        perspective: 1500px;
        display: flex;
        flex-grow: 1;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        padding: 20px;
    }
    #auth-container.is-active { max-width: 1200px; min-height: 95vh; }
    
    .auth-card {
        display: flex;
        width: 100%;
        background: var(--bg-color);
        border-radius: var(--radius-main);
        box-shadow: 15px 15px 30px var(--shadow-dark), -15px -15px 30px var(--shadow-light);
        overflow: hidden;
        animation: slideIn 0.6s ease-out;
        display: none;
    }
    #auth-container.loaded .auth-card { display: flex; }

    /* Blok CSS untuk sidebar dengan gambar custom */
    .auth-sidebar-custom {
        flex: 0 0 45%;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 40px;
        color: #ffffff;
        background-image: url('/blir.gif');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    /*
    PERUBAHAN: BLOK .auth-sidebar-custom::before DIHAPUS DARI SINI
    */

    .sidebar-content {
        position: relative;
        z-index: 1;
        text-align: center;
    }
    
    .sidebar-content h2 {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 15px;
        text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
    }
    .sidebar-content p {
        font-size: 1.1rem;
        max-width: 320px;
        text-shadow: 1px 1px 5px rgba(0,0,0,0.7);
        opacity: 0.9;
    }
    /* Akhir blok CSS perubahan */

    #auth-box {
        flex: 1;
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .brand-header { text-align: left; margin-bottom: 30px; }
    .brand-header h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 8px; color: var(--text-color); }
    .brand-header p { color: var(--text-muted); font-size: 1rem; }
    .brand-header img { display: none; }

    .slider-tabs { position: relative; padding: 5px; border-radius: var(--radius-inner); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); margin-bottom: 25px; overflow: hidden; }
    .slider-tabs-track { display: flex; width: 100%; }
    .tab-label { flex: 1; text-align: center; padding: 14px; font-weight: 600; color: var(--text-muted); cursor: pointer; z-index: 2; transition: color 0.3s ease; }
    .slider-thumb { position: absolute; top: 5px; left: 5px; width: calc(50% - 5px); height: calc(100% - 10px); background: var(--bg-color); border-radius: 10px; box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); transition: transform 0.4s cubic-bezier(0.65, 0.05, 0.36, 1); z-index: 1; }
    .slider-tabs.register-active .slider-thumb { transform: translateX(100%); }
    .slider-tabs.login-active #login-tab-label, .slider-tabs.register-active #register-tab-label { color: var(--primary); }
    
    #auth-flipper { position: relative; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.65, 0.05, 0.36, 1), height 0.4s cubic-bezier(0.65, 0.05, 0.36, 1); margin-bottom: 20px; }
    #auth-flipper.is-flipped { transform: rotateY(180deg); }
    .auth-form-side { position: absolute; top: 0; left: 0; width: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; }
    #register-form-content { transform: rotateY(180deg); }
    
    .input-group { margin-bottom: 25px; text-align: left; }
    .input-group label { display: block; color: var(--text-muted); font-size: 0.9rem; font-weight: 500; margin-bottom: 12px; padding-left: 5px; }
    .input-wrapper { position: relative; }
    .input-field, textarea.input-field { width: 100%; padding: 18px 22px 18px 55px; background: var(--bg-color); border: none; border-radius: var(--radius-inner); color: var(--text-color); font-size: 1rem; box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); transition: var(--transition); }
    textarea.input-field { padding: 18px 22px; resize: vertical; }
    .input-field:focus, textarea.input-field:focus { outline: none; box-shadow: inset 8px 8px 16px var(--shadow-dark), inset -8px -8px 16px var(--shadow-light), 0 0 0 2px var(--primary); }
    .input-wrapper .icon-left { position: absolute; top: 50%; left: 20px; transform: translateY(-50%); color: var(--text-muted); font-size: 1rem; transition: var(--transition); }
    textarea ~ .icon-left { top: 22px; }
    .input-wrapper .icon-right { position: absolute; top: 50%; right: 20px; transform: translateY(-50%); color: var(--text-muted); font-size: 1rem; cursor: pointer; transition: var(--transition); }
    .input-field:focus ~ .icon-left { color: var(--primary); }

    .btn-primary { width: 100%; padding: 18px; background: var(--primary); border: none; border-radius: var(--radius-inner); color: white; font-size: 1.05rem; font-weight: 600; cursor: pointer; transition: var(--transition); box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-3px); background: var(--primary-dark); }
    .btn-primary:active:not(:disabled) { transform: translateY(0); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); }
    .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }
    
    .terms-section { text-align: center; margin-top: 20px; font-size: 0.85rem; color: var(--text-muted); }
    .terms-section a { color: var(--text-muted); text-decoration: underline; font-weight: 500; transition: var(--transition); }
    .terms-section a:hover { color: var(--primary); }

    .btn-google { display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; padding: 16px; background: var(--bg-color); border: none; border-radius: var(--radius-inner); color: var(--text-color); font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--transition); box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); margin-bottom: 20px; }
    .btn-google:hover { transform: translateY(-3px); box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light); }
    .btn-google:active { transform: translateY(0); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); }
    .btn-google svg { width: 24px; height: 24px; }
    .auth-separator { display: flex; align-items: center; text-align: center; color: var(--text-muted); margin: 20px 0; font-size: 0.9rem; font-weight: 500; }
    .auth-separator::before, .auth-separator::after { content: ''; flex: 1; border-bottom: 1px solid var(--shadow-dark); }
    .auth-separator:not(:empty)::before { margin-right: .5em; }
    .auth-separator:not(:empty)::after { margin-left: .5em; }
    
    @media (max-width: 991px) {
        #auth-container { max-width: 450px; padding: 10px; }
        .auth-card { flex-direction: column; }
        .auth-sidebar-custom { display: none; } /* Menyembunyikan sidebar custom di mobile */
        #auth-box { padding: 40px 30px; }
        .brand-header { text-align: center; }
        .brand-header img {
            display: block;
            width: 80px; height: 80px;
            border-radius: var(--radius-inner);
            margin: 0 auto 20px;
            padding: 10px;
            background: var(--bg-color);
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            transition: var(--transition);
        }
        .page-footer .support-section {
            max-width: 450px;
        }
    }
    @media (max-width: 768px) { #auth-box { padding: 30px 20px; } .brand-header img { width: 70px; height: 70px; } }

    /* Admin Panel styles */
    #adminPanelBox { display: none; flex-direction: column; width: 100%; height: 95vh; animation: slideIn 0.6s ease-out; padding: 30px; background: var(--bg-color); border-radius: var(--radius-main); box-shadow: 15px 15px 30px var(--shadow-dark), -15px -15px 30px var(--shadow-light); }
    #auth-container.is-active .auth-card { display: none; }
    #auth-container.is-active #adminPanelBox { display: flex; }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid var(--shadow-light); }
    .panel-header h1 { font-size: 1.8rem; display: flex; align-items: center; gap: 15px; }
    .panel-header h1 i { color: var(--primary); }
    .panel-form { flex-grow: 1; overflow-y: auto; padding: 10px 5px; }
    .panel-form::-webkit-scrollbar { width: 8px; }
    .panel-form::-webkit-scrollbar-track { background: var(--shadow-dark); border-radius: 10px; }
    .panel-form::-webkit-scrollbar-thumb { background-color: var(--primary); border-radius: 10px; border: 2px solid var(--shadow-dark); }
    .panel-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; padding-right: 15px; }
    .panel-section { background: var(--bg-color); border-radius: 20px; padding: 30px; box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); transition: var(--transition); display: flex; flex-direction: column; }
    .panel-section:hover { transform: translateY(-5px); }
    .section-title { display: flex; align-items: center; gap: 15px; font-size: 1.3rem; font-weight: 600; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid var(--shadow-light); }
    .section-title i { color: var(--primary); }
    .carousel-section-container { position: relative; }
    .carousel-track { display: flex; overflow-x: auto; padding: 10px; margin: 0 -10px 15px -10px; gap: 15px; scroll-snap-type: x mandatory; -ms-overflow-style: none; scrollbar-width: none; }
    .carousel-track::-webkit-scrollbar { display: none; }
    .carousel-item { position: relative; flex: 0 0 120px; height: 120px; background: var(--bg-color); border-radius: var(--radius-inner); box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); scroll-snap-align: center; border: 3px solid transparent; text-align: center; padding: 10px; }
    .carousel-item:hover { transform: translateY(-4px); }
    .carousel-item.active { box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light), 0 0 0 3px var(--primary); color: var(--primary); }
    .carousel-item img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 8px; }
    .carousel-item .item-icon { font-size: 2rem; margin-bottom: 10px; }
    .carousel-item .item-name { font-size: 0.85rem; font-weight: 500; word-break: break-all; }
    
    .carousel-item .change-music-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        font-size: 0.7rem;
        color: var(--text-muted);
        cursor: pointer;
        padding: 6px;
        background: var(--bg-color);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: none;
        align-items: center;
        justify-content: center;
        box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
        z-index: 5;
    }
    .carousel-item.active[data-type="upload"] .change-music-btn {
        display: flex;
    }
    .carousel-item .change-music-btn:hover {
        color: var(--primary);
    }

    .carousel-controls { display: flex; align-items: center; justify-content: center; gap: 20px; }
    .carousel-nav-btn { background: var(--bg-color); border: none; border-radius: 50%; color: var(--text-muted); width: 45px; height: 45px; display: flex; justify-content: center; align-items: center; font-size: 1rem; cursor: pointer; transition: var(--transition); box-shadow: 7px 7px 14px var(--shadow-dark), -7px -7px 14px var(--shadow-light); }
    .carousel-nav-btn:hover { color: var(--primary); }
    .carousel-nav-btn:active { box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); }
    #music-preview-btn { width: 65px; height: 65px; font-size: 1.5rem; color: var(--primary); }
    .custom-date-input-wrapper { position: relative; }
    .custom-date-display { background-color: var(--bg-color); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light); border-radius: var(--radius-inner); padding: 0 22px; height: 58px; display: flex; align-items: center; color: var(--text-color); font-size: 1rem; cursor: pointer; transition: var(--transition); }
    .custom-date-display:hover { box-shadow: inset 8px 8px 16px var(--shadow-dark), inset -8px -8px 16px var(--shadow-light); }
    .custom-date-display .icon-left { font-size: 1rem; color: var(--text-muted); margin-right: 18px; }
    .real-date-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; border: none; }
    .qr-preview-image { max-width: 150px; border-radius: var(--radius-inner); display: none; margin-top: 15px; background: var(--bg-color); padding: 8px; box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light); }
    .panel-actions { display: flex; justify-content: space-between; align-items: center; padding-top: 30px; margin-top: auto; }
    .btn { padding: 16px; border: none; background: var(--bg-color); border-radius: var(--radius-inner); cursor: pointer; font-weight: 600; box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
    .btn-save { color: var(--success); }
    .btn-logout { color: var(--error); }
    .btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); }
    .image-upload-box { display: flex; justify-content: center; align-items: center; width: 100%; height: 120px; border: 2px dashed var(--text-muted); border-radius: var(--radius-inner); cursor: pointer; transition: var(--transition); color: var(--text-muted); background-color: var(--bg-color); box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); margin-top: 10px; text-align: center; padding: 10px; }
    .image-upload-box:hover { border-color: var(--primary); color: var(--primary); }
    @media (max-width: 991px) { .panel-layout { display: flex; flex-direction: column; padding-right: 0; } .panel-actions { flex-direction: column-reverse; align-items: stretch; gap: 15px; } .btn { width: 100%; } }

    /* SweetAlert2 specific styles */
    .swal2-popup { background: var(--bg-color) !important; color: var(--text-color) !important; border-radius: var(--radius-main) !important; }
    .swal2-title { color: var(--text-color) !important; }
    .swal2-html-container { color: var(--text-muted) !important; }
    .swal2-confirm, .swal2-cancel, .swal2-deny { border: none !important; border-radius: var(--radius-inner) !important; font-weight: 600 !important; }
    .swal2-confirm { background: var(--primary) !important; color: #fff !important; }
    .swal2-cancel { background-color: var(--bg-color) !important; color: var(--text-muted) !important; }

    /* SweetAlert2 Contact Form styles */
    .swal-contact-form { display: flex; flex-direction: column; align-items: flex-start; text-align: left; }
    .swal-form-group { width: 100%; margin-bottom: 15px; }
    .swal-form-group label { margin-bottom: 8px; font-size: 0.9rem; color: var(--text-muted); display: block; }
    .swal-form-group .swal2-input, .swal-form-group .swal2-textarea { width: 100% !important; margin: 0; background: var(--bg-color) !important; box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light) !important; border: none !important; border-radius: var(--radius-inner) !important; color: var(--text-color) !important; }
    .swal-form-group .swal2-input:focus, .swal-form-group .swal2-textarea:focus { box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light), 0 0 0 2px var(--primary) !important; }

    .page-footer {
        width: 100%;
        margin: 20px 0 0 0;
        padding: 20px 0 10px 0;
        text-align: center;
        border-top: 1px solid var(--shadow-dark);
        animation: slideIn 0.6s ease-out;
    }
    .page-footer .support-section {
        width: 100%;
        max-width: 960px;
        margin: 0 auto;
        padding: 0 20px;
        font-size: 0.9rem;
        color: var(--text-muted);
    }
    .footer-nav { display: flex; justify-content: center; align-items: center; gap: 25px; margin-bottom: 15px; }
    .footer-nav a { color: var(--text-muted); text-decoration: none; font-weight: 500; transition: var(--transition); }
    .footer-nav a:hover { color: var(--primary); }
    
    .footer-copyright { margin: 0; }
    
    .footer-bottom-row {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px 25px;
    }
    
    .footer-creator .fa-heart { color: var(--pink); animation: pulse 1.5s ease-in-out infinite; display: inline-block; }
    
    </style>
</head>
<body>
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
        <i class="fas fa-sun"></i>
    </div>

    <div id="auth-container">
        <div class="auth-card">
            <div class="auth-sidebar-custom">
                <div class="sidebar-content">
                    <h2>Let's get the party started!</h2>
                    <p>Create beautiful digital wishes and share them with your loved ones.</p>
                </div>
            </div>
            
            <div id="auth-box">
                <div class="brand-header">
                    <img src="/IMG_1551.png" alt="Logo">
                    <h1 id="form-title">Selamat datang!</h1>
                    <p id="auth-subtitle">Masuk untuk melanjutkan</p>
                </div>
                
                <div class="slider-tabs" id="slider-tabs-container">
                    <div class="slider-tabs-track">
                        <span class="tab-label" id="login-tab-label">Login</span>
                        <span class="tab-label" id="register-tab-label">Register</span>
                    </div>
                    <div class="slider-thumb"></div>
                </div>

                <button class="btn-google" id="google-signin-btn">
                    <svg viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.021,35.596,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                    <span>Continue with Google</span>
                </button>
                
                <div class="auth-separator">OR CONTINUE WITH</div>

                <div id="auth-flipper">
                    <div class="auth-form-side" id="login-form-content">
                        <div class="input-group">
                            <label for="loginEmail">Email</label>
                            <div class="input-wrapper">
                                <i class="fas fa-envelope icon-left"></i>
                                <input type="email" id="loginEmail" class="input-field" placeholder="Ketik email Anda">
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="loginPass">Password</label>
                            <div class="input-wrapper">
                                <i class="fas fa-key icon-left"></i>
                                <input type="password" id="loginPass" class="input-field" placeholder="••••••••••">
                                <i class="fas fa-eye-slash icon-right" onclick="togglePasswordVisibility('loginPass', this)"></i>
                            </div>
                        </div>
                    </div>
                    <div class="auth-form-side" id="register-form-content">
                        <div class="input-group">
                            <label for="registerEmail">Email</label>
                            <div class="input-wrapper">
                                <i class="fas fa-envelope icon-left"></i>
                                <input type="email" id="registerEmail" class="input-field" placeholder="Gunakan email aktif" required>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="registerPass">Password Baru</label>
                            <div class="input-wrapper">
                                <i class="fas fa-key icon-left"></i>
                                <input type="password" id="registerPass" class="input-field" placeholder="Minimal 6 karakter" required>
                                <i class="fas fa-eye-slash icon-right" onclick="togglePasswordVisibility('registerPass', this)"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="btn-primary" id="main-action-btn"><i class="fas fa-sign-in-alt"></i> Masuk</button>
                
                <div class="terms-section">
                    <p>By clicking continue, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>
                </div>

            </div>
        </div>
        
        <div id="adminPanelBox">
            <div class="panel-header">
                <h1><i class="fas fa-cogs"></i> Setting Panel</h1>
            </div>
            <form id="editForm" onsubmit="event.preventDefault(); saveData();" class="panel-form">
                <div class="panel-layout">
                    <div class="layout-column">
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-birthday-cake"></i><span>Info Utama</span></div>
                            <div class="input-group">
                                <label for="birthdayNameInput">Nama</label>
                                <div class="input-wrapper"><i class="fas fa-user-edit icon-left"></i><input type="text" id="birthdayNameInput" class="input-field" required></div>
                            </div>
                            <div class="input-group">
                                <label for="birthDateInput">Tanggal Lahir</label>
                                <div class="custom-date-input-wrapper">
                                    <div class="custom-date-display"><i class="fas fa-calendar-alt icon-left"></i><span id="dateDisplayText">Pilih Tanggal</span></div>
                                    <input type="date" id="birthDateInput" class="real-date-input" required>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="bestWishesInput">Harapan Terbaik</label>
                                <div class="input-wrapper"><textarea id="bestWishesInput" class="input-field" rows="4" placeholder="Masukkan harapan terbaik..."></textarea></div>
                            </div>
                            <div class="input-group">
                                <label for="stayStrongQuoteInput">Kesan atau quotes</label>
                                <div class="input-wrapper"><textarea id="stayStrongQuoteInput" class="input-field" rows="3" placeholder="Masukkan quote..."></textarea></div>
                            </div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-users"></i><span>Akses Tamu</span></div>
                            <div class="input-group">
                                <label for="guestUserInput">Username Tamu</label>
                                <div class="input-wrapper"><i class="fas fa-user icon-left"></i><input type="text" id="guestUserInput" class="input-field" required></div>
                            </div>
                            <div class="input-group">
                                <label for="guestPassInput">Password Tamu</label>
                                <div class="input-wrapper"><i class="fas fa-lock icon-left"></i><input type="text" id="guestPassInput" class="input-field" required></div>
                            </div>
                            <div class="input-group">
                                <label for="targetWhatsappNumber">Nomor WhatsApp Target</label>
                                <div class="input-wrapper"><i class="fab fa-whatsapp icon-left"></i><input type="tel" id="targetWhatsappNumber" class="input-field" placeholder="6281xxxxxxxx"></div>
                            </div>
                        </div>
                    </div>

                    <div class="layout-column">
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-music"></i><span>Pilih Musik Latar</span></div>
                            <div class="carousel-section-container">
                                <div class="carousel-track" id="music-carousel-track"></div>
                                <div class="carousel-controls">
                                    <button type="button" id="prevMusicBtn" class="carousel-nav-btn"><i class="fas fa-chevron-left"></i></button>
                                    <button type="button" id="music-preview-btn" class="carousel-nav-btn"><i class="fas fa-play"></i></button>
                                    <button type="button" id="nextMusicBtn" class="carousel-nav-btn"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-gift"></i><span>Pilih Ikon Kado</span></div>
                             <div class="carousel-section-container">
                                <div class="carousel-track" id="gift-carousel-track"></div>
                                <div class="carousel-controls">
                                    <button type="button" id="prevGiftBtn" class="carousel-nav-btn"><i class="fas fa-chevron-left"></i></button>
                                    <button type="button" id="nextGiftBtn" class="carousel-nav-btn"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-puzzle-piece"></i><span>Setting Game Kata</span></div>
                            <div class="input-group"><label for="puzzleWord1">Kata Tersembunyi 1</label><div class="input-wrapper"><i class="fas fa-font icon-left"></i><input type="text" id="puzzleWord1" class="input-field" placeholder="Contoh: ULTAH" maxlength="8" required></div></div>
                            <div class="input-group"><label for="puzzleWord2">Kata Tersembunyi 2</label><div class="input-wrapper"><i class="fas fa-font icon-left"></i><input type="text" id="puzzleWord2" class="input-field" placeholder="Contoh: KADO" maxlength="8" required></div></div>
                            <div class="input-group"><label for="puzzleWord3">Kata Tersembunyi 3</label><div class="input-wrapper"><i class="fas fa-font icon-left"></i><input type="text" id="puzzleWord3" class="input-field" placeholder="Contoh: DOA" maxlength="8" required></div></div>
                        </div>
                        
                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-qrcode"></i><span>Kode QR</span></div>
                            <div class="input-group">
                                <label for="qrImageUploadInput">Unggah Gambar QR</label>
                                <label for="qrImageUploadInput" class="image-upload-box">
                                    <span id="uploadBoxText"><i class="fas fa-upload"></i> Klik atau jatuhkan file di sini</span>
                                    <input type="file" id="qrImageUploadInput" accept="image/png, image/jpeg, image/gif" style="display: none;">
                                </label>
                                <img id="qrPreviewImage" class="qr-preview-image" src="" alt="Pratinjau QR">
                            </div>
                            <div class="input-group">
                                <label for="qrMessageInput">Pesan di bawah QR</label>
                                <div class="input-wrapper">
                                    <textarea id="qrMessageInput" class="input-field" rows="3" placeholder="Masukkan pesan di bawah QR code..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="panel-section">
                            <div class="section-title"><i class="fas fa-share-alt"></i><span>Link Publik</span></div>
                            <div class="input-group">
                                <label for="shareableLink">Bagikan link ini</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-link icon-left"></i>
                                    <input type="text" id="shareableLink" class="input-field" readonly>
                                    <i class="fas fa-copy icon-right" id="copyLinkBtn" title="Salin Link"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="panel-actions">
                <button type="button" class="btn btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Log Out</button>
                <button type="submit" form="editForm" class="btn btn-save"><i class="fas fa-save"></i> Simpan Semua Perubahan</button>
            </div>
        </div>
    </div>
    
    <div class="page-footer">
        <div class="support-section">
            <div class="footer-nav">
                <a href="index.html">Home</a>
                <a href="#">Dashboard</a>
                <a href="#" id="contact-link">Contact</a>
            </div>
            <div class="footer-bottom-row">
                <p class="footer-copyright">
                    © 2025 xlordcode. All rights reserved.
                </p>
                <p class="footer-creator">
                    Made with <i class="fas fa-heart"></i> by MunMun
                </p>
            </div>
        </div>
    </div>
    
    <input type="file" id="musicUploadInput" accept="audio/*" style="display: none;" />
    <audio id="musicPreviewPlayer"></audio>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
    // =================================================================
    // KONFIGURASI FIREBASE & SUPABASE
    // =================================================================

    // --- Konfigurasi Firebase (Untuk Login dan Database) ---
    const firebaseConfig = {
        apiKey: "AIzaSyCWl2CJqIr-u8lSHu8s4tgZ25UQIK2ivt0",
        authDomain: "mayfa-fa284.firebaseapp.com",
        databaseURL: "https://mayfa-fa284-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "mayfa-fa284",
        storageBucket: "mayfa-fa284.appspot.com",
        messagingSenderId: "523290705179",
        appId: "1:523290705179:web:b06ae4d8e6b08cf07b27be"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const storage = firebase.storage(); // Untuk QR Code

    // --- Konfigurasi Supabase (Untuk Unggah Musik) ---
    const SUPABASE_URL = 'https://qwixfwotqmknzzbdvynk.supabase.co'; 
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3aXhmd290cW1rbnp6YmR2eW5rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODIyMzgsImV4cCI6MjA2ODI1ODIzOH0.qdtutb3H2e8zy-NZmu-m33TXJmnGrTPOnto0Z36Yc-Q'; 
    
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


    // =================================================================
    // DOM Elements & Variabel Global
    // =================================================================
    const authContainer = document.getElementById('auth-container');
    const authFlipper = document.getElementById('auth-flipper');
    const mainActionBtn = document.getElementById('main-action-btn');
    const loginTabLabel = document.getElementById('login-tab-label');
    const registerTabLabel = document.getElementById('register-tab-label');
    const sliderTabsContainer = document.getElementById('slider-tabs-container');
    const themeToggle = document.getElementById('themeToggle');
    const musicCarouselTrack = document.getElementById('music-carousel-track');
    const giftCarouselTrack = document.getElementById('gift-carousel-track');
    const musicPreviewPlayer = document.getElementById('musicPreviewPlayer');
    const pageFooter = document.querySelector('.page-footer');
    
    let newQrImageUrl = null;
    let customMusic = null; 
    let currentMusicIndex = 0;

    const musicTracks = [ 
        { name: "Musik 1", path: "/musik/musik1.mp3" }, 
        { name: "Musik 2", path: "/musik/musik2.mp3" }, 
        { name: "Musik 3", path: "/musik/musik3.mp3" }, 
        { name: "Musik 4", path: "/musik/musik4.mp3" }, 
        { name: "Musik 5", path: "/musik/musik5.mp3" },
        { name: "Upload Musik", type: "upload", icon: "fas fa-upload" }
    ];
    const giftIcons = [ { name: "Kado1", path: "nir.gif" }, { name: "Kado2", path: "/img/gif1.gif" }, { name: "Kado3", path: "/img/gif2.gif" }, { name: "Kado4", path: "/img/gif3.gif" } ];
    let currentGiftIndex = 0;

    // =================================================================
    // Fungsi-Fungsi Utama Aplikasi
    // =================================================================

    function showAdminPanel(user) { 
        if (!user) return; 
        authContainer.classList.add('is-active'); 
        pageFooter.style.display = 'none';
        loadDataToForm(user); 
    }
    themeToggle.addEventListener('click', () => { const currentTheme = document.documentElement.getAttribute('data-theme'); const newTheme = currentTheme === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', newTheme); localStorage.setItem('theme', newTheme); });
    function initTheme() { const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'); document.documentElement.setAttribute('data-theme', savedTheme); }
    function togglePasswordVisibility(fieldId, icon) { const field = document.getElementById(fieldId); if (field) { field.type = field.type === "password" ? "text" : "password"; icon.classList.toggle('fa-eye'); icon.classList.toggle('fa-eye-slash'); } }
    function showLoginView() { sliderTabsContainer.classList.add('login-active'); sliderTabsContainer.classList.remove('register-active'); authFlipper.classList.remove('is-flipped'); mainActionBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Masuk'; document.getElementById('auth-subtitle').textContent = 'Masuk untuk melanjutkan'; document.getElementById('form-title').textContent = 'Selamat datang!'; setTimeout(() => { const loginForm = document.getElementById('login-form-content'); if (loginForm) { authFlipper.style.height = `${loginForm.offsetHeight}px`; } }, 50); }
    function showRegisterView() { sliderTabsContainer.classList.remove('login-active'); sliderTabsContainer.classList.add('register-active'); authFlipper.classList.add('is-flipped'); mainActionBtn.innerHTML = '<i class="fas fa-user-plus"></i> Daftar Sekarang'; document.getElementById('auth-subtitle').textContent = 'Buat akun untuk memulai'; document.getElementById('form-title').textContent = 'Buat Akun Anda'; setTimeout(() => { const registerForm = document.getElementById('register-form-content'); if (registerForm) { authFlipper.style.height = `${registerForm.offsetHeight}px`; } }, 50); }
    function showContactForm() { Swal.fire({ title: 'Contact me', html: `<div class="swal-contact-form"><div class="swal-form-group"><label for="swal-name">Nama Anda</label><input id="swal-name" class="swal2-input" placeholder="Namamu"></div><div class="swal-form-group"><label for="swal-email">Email Anda</label><input id="swal-email" type="email" class="swal2-input" placeholder="urmail@example.com"></div><div class="swal-form-group"><label for="swal-message">Pesan Anda</label><textarea id="swal-message" class="swal2-textarea" placeholder="Tulis pesan Anda di sini..."></textarea></div></div>`, showCancelButton: true, confirmButtonText: 'Kirim Pesan', cancelButtonText: 'Batal', preConfirm: () => { const name = document.getElementById('swal-name').value; const email = document.getElementById('swal-email').value; const message = document.getElementById('swal-message').value; if (!name || !email || !message) { Swal.showValidationMessage(`Harap isi semua kolom`); } return { name, email, message }; } }).then((result) => { if (result.isConfirmed) { Swal.fire('Terkirim!', 'Terima kasih telah menghubungi kami.', 'success'); } }); }

    function renderCarousels() { 
        musicCarouselTrack.innerHTML = musicTracks.map((track, index) => {
            const isUploadBtn = track.type === 'upload';
            const iconClass = isUploadBtn ? track.icon : 'fas fa-music';
            const changeBtnHtml = isUploadBtn ? '<i class="fas fa-sync-alt change-music-btn" title="Ganti Musik"></i>' : '';
            return `<div class="carousel-item" data-index="${index}" ${isUploadBtn ? 'data-type="upload"' : ''}>
                        ${changeBtnHtml}
                        <i class="${iconClass} item-icon"></i>
                        <span class="item-name">${track.name}</span>
                    </div>`;
        }).join('');
        giftCarouselTrack.innerHTML = giftIcons.map((gift, index) => `<div class="carousel-item" data-index="${index}"><img src="${gift.path}" alt="${gift.name}"><span class="item-name">${gift.name}</span></div>`).join(''); 
        addCarouselListeners(); 
    }

    function addCarouselListeners() { 
        musicCarouselTrack.addEventListener('click', e => {
            const changeButton = e.target.closest('.change-music-btn');
            if (changeButton) {
                e.stopPropagation();
                document.getElementById('musicUploadInput').click();
                return;
            }

            const item = e.target.closest('.carousel-item'); 
            if (item) {
                if (item.dataset.type === 'upload') {
                    if (customMusic) {
                        currentMusicIndex = -1;
                        updateMusicSelection();
                    } else {
                        document.getElementById('musicUploadInput').click();
                    }
                } else {
                    currentMusicIndex = parseInt(item.dataset.index); 
                    customMusic = null;
                    updateMusicSelection(); 
                }
            } 
        }); 
        giftCarouselTrack.addEventListener('click', e => { const item = e.target.closest('.carousel-item'); if (item) { currentGiftIndex = parseInt(item.dataset.index); updateGiftSelection(); } }); 
    }

    function updateMusicSelection() {
        const musicItems = musicCarouselTrack.querySelectorAll('.carousel-item');
        let activeItem = null;

        musicItems.forEach((item, index) => {
            const isCustomActive = currentMusicIndex === -1 && item.dataset.type === 'upload';
            const isPresetActive = index === currentMusicIndex;
            const isActive = isCustomActive || isPresetActive;
            
            item.classList.toggle('active', isActive);
            if (isActive) activeItem = item;
        });

        if (activeItem) {
            let musicSource = '';
            if (currentMusicIndex === -1 && customMusic) {
                 musicSource = customMusic.path;
            } else if (currentMusicIndex !== -1) {
                 musicSource = musicTracks[currentMusicIndex].path;
            }
            musicPreviewPlayer.src = musicSource;
            activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
        document.getElementById('music-preview-btn').querySelector('i').classList.replace('fa-pause', 'fa-play');
    }

    function updateGiftSelection() { giftCarouselTrack.querySelectorAll('.carousel-item').forEach(item => { item.classList.toggle('active', parseInt(item.dataset.index) === currentGiftIndex); }); const activeItem = giftCarouselTrack.querySelector('.active'); if (activeItem) { activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); } }
    function formatDateForDisplay(dateString) { if (!dateString) return "Pilih Tanggal"; const date = new Date(dateString); const monthNames = ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Ags", "Sep", "Okt", "Nov", "Des"]; return `${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}`; }
    function setButtonLoading(isLoading, text = '') { mainActionBtn.disabled = isLoading; document.getElementById('google-signin-btn').disabled = isLoading; if (isLoading) { mainActionBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text || 'Memproses...'}`; } else { if (sliderTabsContainer.classList.contains('register-active')) { showRegisterView(); } else { showLoginView(); } } }
    function handleMainAction() { if (sliderTabsContainer.classList.contains('register-active')) { createAccount(); } else { loginWithEmail(); } }
    
    function createAccount() { const email = document.getElementById('registerEmail').value.trim(); const password = document.getElementById('registerPass').value; if (!email || !password) { Swal.fire('Input Tidak Lengkap', 'Email dan password wajib diisi.', 'warning'); return; } if (password.length < 6) { Swal.fire('Password Terlalu Pendek', 'Password minimal harus 6 karakter.', 'warning'); return; } setButtonLoading(true, 'Membuat Akun...'); auth.createUserWithEmailAndPassword(email, password).then(userCredential => { const user = userCredential.user; return createDefaultUserData(user).then(() => { return user.sendEmailVerification().then(() => { Swal.fire({ icon: 'success', title: 'Registrasi Berhasil!', html: `Satu langkah lagi! Kami telah mengirimkan email verifikasi ke <b>${email}</b>. Silakan periksa kotak masuk Anda.<br><br>Halaman ini akan masuk secara otomatis setelah verifikasi selesai.`, allowOutsideClick: false, showConfirmButton: false, willOpen: () => { Swal.showLoading(); const verificationCheckInterval = setInterval(() => { auth.currentUser.reload().then(() => { if (auth.currentUser.emailVerified) { clearInterval(verificationCheckInterval); Swal.close(); showAdminPanel(auth.currentUser); } }); }, 2500); } }); }); }); }).catch(error => { const message = error.code === 'auth/email-already-in-use' ? 'Email ini sudah terdaftar. Silakan login.' : 'Terjadi error: ' + error.message; Swal.fire('Registrasi Gagal', message, 'error'); }).finally(() => setButtonLoading(false)); }
    function loginWithEmail() { const email = document.getElementById('loginEmail').value.trim(); const password = document.getElementById('loginPass').value; if (!email || !password) { Swal.fire('Input Diperlukan', 'Email dan password harus diisi.', 'warning'); return; } setButtonLoading(true, 'Memverifikasi...'); auth.signInWithEmailAndPassword(email, password).then(userCredential => { if (!userCredential.user.emailVerified) { auth.signOut(); Swal.fire({ icon: 'warning', title: 'Email Belum Diverifikasi', html: `Silakan periksa email <b>${email}</b> dan klik link verifikasi.`, confirmButtonText: 'Kirim Ulang Email', showCancelButton: true, cancelButtonText: 'Tutup' }).then(result => { if (result.isConfirmed) { userCredential.user.sendEmailVerification().then(() => { Swal.fire('Terkirim!', 'Email verifikasi baru telah dikirim.', 'success'); }); } }); } }).catch(error => { Swal.fire('Login Gagal', 'Email atau password yang Anda masukkan salah.', 'error'); }).finally(() => setButtonLoading(false)); }
    function signInWithGoogle() { const provider = new firebase.auth.GoogleAuthProvider(); setButtonLoading(true, 'Membuka Google...'); auth.signInWithPopup(provider).then(result => { if (result.additionalUserInfo.isNewUser) { return createDefaultUserData(result.user); } }).catch(error => { if (error.code !== 'auth/popup-closed-by-user') { Swal.fire('Login Google Gagal', error.message, 'error'); } }).finally(() => setButtonLoading(false)); }
    function createDefaultUserData(user) { const nameFromEmail = user.email.split('@')[0]; const defaultDisplayName = user.displayName || nameFromEmail; const defaultData = { birthdayName: defaultDisplayName, birthDate: "2005-09-28", guestUser: "tamu", guestPass: "12345", qrImageUrl: "", bestWishes: "", stayStrongQuote: "", qrMessage: "", targetWhatsappNumber: "", puzzleWord1: 'ULTAH', puzzleWord2: 'KADO', puzzleWord3: 'DOA', musicUrl: musicTracks[0].path, giftIconUrl: giftIcons[0].path }; return database.ref('birthday_pages/' + user.uid).set(defaultData); }
    function copyShareableLink() { const linkInput = document.getElementById('shareableLink'); if (linkInput.value) { navigator.clipboard.writeText(linkInput.value).then(() => { Swal.fire({ icon: 'success', title: 'Link Berhasil Disalin!', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 }); }); } }
    function logout() { Swal.fire({ title: 'Konfirmasi Log Out', text: 'Anda yakin ingin keluar?', icon: 'question', showCancelButton: true, confirmButtonText: 'Ya, Log Out', cancelButtonText: 'Batal', reverseButtons: true }).then((result) => { if (result.isConfirmed) { musicPreviewPlayer.pause(); auth.signOut(); } }); }
    
    function loadDataToForm(user) {
        if (!user) return;
        Swal.fire({ icon: 'success', title: `Selamat Datang, ${user.displayName || user.email.split('@')[0]}!`, toast: true, position: 'top-end', showConfirmButton: false, timer: 3000, timerProgressBar: true, didOpen: () => confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } }) });

        database.ref('birthday_pages/' + user.uid).once('value').then(snapshot => {
            const data = snapshot.val() || {};
            document.getElementById('birthdayNameInput').value = data.birthdayName || '';
            document.getElementById('bestWishesInput').value = data.bestWishes || '';
            document.getElementById('stayStrongQuoteInput').value = data.stayStrongQuote || '';
            document.getElementById('guestUserInput').value = data.guestUser || '';
            document.getElementById('guestPassInput').value = data.guestPass || '';
            document.getElementById('targetWhatsappNumber').value = data.targetWhatsappNumber || '';
            document.getElementById('shareableLink').value = `${window.location.origin}/login.html?id=${user.uid}`;
            document.getElementById('puzzleWord1').value = data.puzzleWord1 || '';
            document.getElementById('puzzleWord2').value = data.puzzleWord2 || '';
            document.getElementById('puzzleWord3').value = data.puzzleWord3 || '';
            document.getElementById('qrMessageInput').value = data.qrMessage || '';
            
            const qrPreviewImage = document.getElementById('qrPreviewImage');
            if (data.qrImageUrl) { qrPreviewImage.src = data.qrImageUrl; qrPreviewImage.style.display = 'block'; } else { qrPreviewImage.style.display = 'none'; }

            document.getElementById('birthDateInput').value = data.birthDate || '';
            document.getElementById('dateDisplayText').textContent = formatDateForDisplay(data.birthDate);
            
            const savedMusicPath = data.musicUrl || musicTracks[0].path;
            const preDefinedTrackIndex = musicTracks.findIndex(track => track.path === savedMusicPath && track.type !== 'upload');

            if (preDefinedTrackIndex !== -1) {
                currentMusicIndex = preDefinedTrackIndex;
                customMusic = null;
            } else {
                customMusic = { name: 'Musik Pilihan', path: savedMusicPath };
                currentMusicIndex = -1;
                const uploadBtn = musicCarouselTrack.querySelector('[data-type="upload"]');
                if(uploadBtn) {
                    uploadBtn.querySelector('.item-icon').className = 'fas fa-check-circle item-icon';
                    uploadBtn.querySelector('.item-name').textContent = 'Musik Pilihan';
                }
            }
            updateMusicSelection();

            const savedGiftPath = data.giftIconUrl || giftIcons[0].path;
            currentGiftIndex = Math.max(0, giftIcons.findIndex(icon => icon.path === savedGiftPath));
            updateGiftSelection();

        }).catch(err => Swal.fire('Gagal Memuat Data', err.message, 'error'));
    }

    function saveData() {
        const user = auth.currentUser;
        if (!user) return;

        const saveBtn = document.querySelector('.btn-save');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Menyimpan...';
        
        database.ref('birthday_pages/' + user.uid).once('value').then(snapshot => {
            const existingData = snapshot.val() || {};
            let musicUrlToSave = existingData.musicUrl; 

            if (currentMusicIndex !== -1) {
                musicUrlToSave = musicTracks[currentMusicIndex].path;
            } else if (customMusic) {
                if (customMusic.path && !customMusic.path.startsWith('blob:')) {
                    musicUrlToSave = customMusic.path;
                }
            }

            const settings = {
                birthdayName: document.getElementById('birthdayNameInput').value,
                birthDate: document.getElementById('birthDateInput').value,
                bestWishes: document.getElementById('bestWishesInput').value,
                stayStrongQuote: document.getElementById('stayStrongQuoteInput').value,
                guestUser: document.getElementById('guestUserInput').value,
                guestPass: document.getElementById('guestPassInput').value,
                targetWhatsappNumber: document.getElementById('targetWhatsappNumber').value.trim(),
                puzzleWord1: document.getElementById('puzzleWord1').value.trim().toUpperCase(),
                puzzleWord2: document.getElementById('puzzleWord2').value.trim().toUpperCase(),
                puzzleWord3: document.getElementById('puzzleWord3').value.trim().toUpperCase(),
                qrImageUrl: newQrImageUrl || document.getElementById('qrPreviewImage').src,
                qrMessage: document.getElementById('qrMessageInput').value,
                musicUrl: musicUrlToSave,
                giftIconUrl: giftIcons[currentGiftIndex].path
            };

            return database.ref('birthday_pages/' + user.uid).update(settings);

        }).then(() => {
            newQrImageUrl = null;
            const settings = { 
                birthdayName: document.getElementById('birthdayNameInput').value,
                guestUser: document.getElementById('guestUserInput').value,
                guestPass: document.getElementById('guestPassInput').value,
                targetWhatsappNumber: document.getElementById('targetWhatsappNumber').value.trim()
            };
            const shareableLink = document.getElementById('shareableLink').value;
            const messageText = `Halo *${settings.birthdayName}*! 👋\n\nKejutan spesialmu sudah siap! 🎉 Akses halaman ulang tahunmu di link ini:\n\n🔗 *Link Halaman Ulang Tahun:*\n${shareableLink}\n\nDetail untuk masuk:\n👤 *Username:* ${settings.guestUser}\n🔑 *Password:* ${settings.guestPass}\n\n*Jangan lupa login ya!* ✨`.trim();
            Swal.fire({
                title: 'Data Berhasil Disimpan!',
                html: 'Semua perubahan telah disimpan.<br>Pilih tindakan selanjutnya:',
                icon: 'success',
                showCancelButton: true,
                showDenyButton: true,
                confirmButtonText: '<i class="fab fa-whatsapp"></i> Kirim via WA',
                denyButtonText: '<i class="fas fa-copy"></i> Salin Info',
                cancelButtonText: 'Selesai',
                reverseButtons: true,
            }).then((result) => {
                if (result.isConfirmed) {
                    if (settings.targetWhatsappNumber) {
                        window.open(`https://wa.me/${settings.targetWhatsappNumber}?text=${encodeURIComponent(messageText)}`, '_blank');
                    } else {
                        Swal.fire({ icon: 'info', title: 'Nomor WhatsApp Kosong', text: 'Nomor WhatsApp target belum diisi.' });
                    }
                } else if (result.isDenied) {
                    navigator.clipboard.writeText(messageText).then(() => Swal.fire({ icon: 'success', title: 'Disalin!', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 }));
                }
            });
        }).catch(e => Swal.fire('Gagal Menyimpan', e.message, 'error'))
        .finally(() => {
            const saveBtn = document.querySelector('.btn-save');
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Simpan Semua Perubahan';
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        renderCarousels();
        
        auth.onAuthStateChanged(user => {
            if (user && user.emailVerified) {
                showAdminPanel(user);
            }
            else {
                authContainer.classList.remove('is-active');
                document.getElementById('auth-container').classList.add('loaded');
                pageFooter.style.display = ''; 
                if (!user) {
                    showLoginView();
                }
            }
        });

        loginTabLabel.addEventListener('click', showLoginView);
        registerTabLabel.addEventListener('click', showRegisterView);
        mainActionBtn.addEventListener('click', handleMainAction);
        document.getElementById('google-signin-btn').addEventListener('click', signInWithGoogle);
        document.getElementById('copyLinkBtn').addEventListener('click', copyShareableLink);
        document.getElementById('birthDateInput').addEventListener('change', () => { document.getElementById('dateDisplayText').textContent = formatDateForDisplay(document.getElementById('birthDateInput').value); });
        document.getElementById('contact-link').addEventListener('click', (event) => { event.preventDefault(); showContactForm(); });
        document.getElementById('prevMusicBtn').addEventListener('click', () => { if (currentMusicIndex > 0) { currentMusicIndex--; } else { currentMusicIndex = musicTracks.findIndex(t => t.type !== 'upload'); } updateMusicSelection(); });
        document.getElementById('nextMusicBtn').addEventListener('click', () => { const lastPresetIndex = musicTracks.findIndex(t => t.type === 'upload') - 1; if (currentMusicIndex < lastPresetIndex && currentMusicIndex !== -1) { currentMusicIndex++; } else { currentMusicIndex = 0; } updateMusicSelection(); });
        document.getElementById('music-preview-btn').addEventListener('click', () => { const icon = document.getElementById('music-preview-btn').querySelector('i'); if (musicPreviewPlayer.paused) { musicPreviewPlayer.play().catch(e => console.error("Audio play failed", e)); icon.classList.replace('fa-play', 'fa-pause'); } else { musicPreviewPlayer.pause(); icon.classList.replace('fa-pause', 'fa-play'); } });
        musicPreviewPlayer.onended = () => { document.getElementById('music-preview-btn').querySelector('i').classList.replace('fa-pause', 'fa-play'); };
        document.getElementById('prevGiftBtn').addEventListener('click', () => { currentGiftIndex = (currentGiftIndex - 1 + giftIcons.length) % giftIcons.length; updateGiftSelection(); });
        document.getElementById('nextGiftBtn').addEventListener('click', () => { currentGiftIndex = (currentGiftIndex + 1) % giftIcons.length; updateGiftSelection(); });

        document.getElementById('musicUploadInput').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const user = auth.currentUser;
            if (!user) {
                Swal.fire('Error', 'Anda harus login untuk mengunggah musik.', 'error');
                return;
            }
            const localUrl = URL.createObjectURL(file);
            customMusic = { name: file.name, path: localUrl };
            currentMusicIndex = -1;
            updateMusicSelection();
            const uploadBtnElement = document.querySelector('.carousel-item[data-type="upload"]');
            const iconElement = uploadBtnElement.querySelector('.item-icon');
            const nameElement = uploadBtnElement.querySelector('.item-name');
            iconElement.className = 'fas fa-spinner fa-spin item-icon';
            nameElement.textContent = 'Mengunggah...';
            try {
                const filePath = `${user.uid}/${Date.now()}-${file.name}`;
                const { data, error } = await supabaseClient
                    .storage
                    .from('music-uploads')
                    .upload(filePath, file);
                if (error) { throw error; }
                const { data: publicUrlData } = supabaseClient
                    .storage
                    .from('music-uploads')
                    .getPublicUrl(filePath);
                if (customMusic) {
                    customMusic.path = publicUrlData.publicUrl;
                }
                iconElement.className = 'fas fa-check-circle item-icon';
                nameElement.textContent = file.name.length > 15 ? file.name.substring(0, 12) + '...' : file.name;
                Swal.fire({icon: 'success', title: 'Upload Sukses!', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000});
            } catch (error) {
                console.error("Upload ke Supabase Gagal:", error);
                Swal.fire('Upload Gagal', 'Terjadi kesalahan saat mengunggah.', 'error');
                iconElement.className = 'fas fa-upload item-icon';
                nameElement.textContent = 'Upload Musik';
                customMusic = null;
                currentMusicIndex = 0;
                updateMusicSelection();
            }
        });

        const qrUploadInput = document.getElementById('qrImageUploadInput');
        qrUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) { return; }
            const reader = new FileReader();
            reader.onload = (e) => { document.getElementById('qrPreviewImage').src = e.target.result; document.getElementById('qrPreviewImage').style.display = 'block'; document.getElementById('uploadBoxText').innerHTML = `<i class="fas fa-check-circle"></i> Gambar dipilih!`; };
            reader.readAsDataURL(file);
            const user = auth.currentUser;
            if (!user) { Swal.fire('Error', 'Anda harus login.', 'error'); return; }
            newQrImageUrl = null;
            const filePath = `qr_codes/${user.uid}/${Date.now()}-${file.name}`;
            const uploadTask = storage.ref(filePath).put(file);
            uploadTask.on('state_changed', null, (error) => { Swal.fire('Upload Gagal', 'Terjadi kesalahan.', 'error'); }, () => { uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => { newQrImageUrl = downloadURL; document.getElementById('uploadBoxText').innerHTML = `<i class="fas fa-check-circle"></i> Berhasil diunggah!`; }); });
        });
    });
    </script>
</body>
</html>