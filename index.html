<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        /* ... (CSS tetap sama) ... */
    </style>
</head>
<body>
    <audio id="background-music" loop><source src="mayfa.mp3"></audio>
    <div class="login-container" id="loginContainer">
        <div class="login-box" id="loginBox">
            <div class="glow-effect"></div>
            <div class="login-header">
                <div class="login-icon">
                    <i class="fas fa-birthday-cake"></i>
                    <div class="candle"></div>
                    <div class="flame"></div>
                </div>
                <h1> Login Dulu Yaâœ¨</h1>
            </div>
            <div class="input-group">
                <i class="fas fa-user icon"></i>
                <input type="text" id="username" placeholder="Username">
            </div>
            <div class="input-group">
                <i class="fas fa-lock icon"></i>
                <input type="password" id="password" placeholder="Password">
                <i class="fas fa-eye" id="togglePassword"></i>
            </div>
            <div class="login-options">
                <a href="admin.html" class="admin-link" title="Pengaturan Admin"><i class="fas fa-cog"></i> Admin</a>
            </div>
            <button class="login-btn" onclick="login()">Login</button>
            <div class="login-footer">
                Masukkan kredensial untuk melihat kejutan spesial
            </div>
        </div>
    </div>
    <div class="birthday-page-container" id="birthdayPage">
        <div class="birthday-content">
            <h1 class="main-title">Happy Birthday, <span id="birthdayName">Mayfa!</span></h1>
            <div class="card-grid">
                <div class="message-card">
                    <i class="fas fa-calendar-check card-icon"></i>
                    <h2 class="card-title">Spesial Untukmu</h2>
                    <p class="card-text" id="ageDisplay"></p>
                </div>
                <div class="message-card">
                    <i class="fas fa-star card-icon"></i>
                    <h2 class="card-title">Harapan Terbaik</h2>
                    <p class="card-text">Semoga di hari spesial ini, kamu dikelilingi oleh kebahagiaan, cinta, dan semua hal indah yang kamu impikan.</p>
                </div>
                <div class="message-card">
                    <i class="fas fa-heart card-icon"></i>
                    <h2 class="card-title">Tetap Kuat</h2>
                    <p class="card-text">"Sudah berapa lama kamu bertahan?" Apapun yang terjadi, kamu hebat. Teruslah melangkah!</p>
                </div>
            </div>
            <div class="message-card" style="margin-top: 20px; animation-delay: 1.4s;">
                <h2 class="card-title">Ada Sesuatu Untukmu...</h2>
                <button class="gift-btn-modern" onclick="openGift()">
                    <i class="fas fa-gift"></i> Buka Hadiah Spesial
                </button>
            </div>
        </div>
    </div>
    <div class="gift-modal" id="giftModal">
        <div class="gift-box" onclick="openCard()">
            <img src="/IMG_1316.png" alt="Gift Box" style="width: 100%; height: 100%; object-fit: contain;">
        </div>
        <div class="gift-card" id="giftCard">
            <h2 style="font-weight: 600;">Hadiah Spesial untuk <span id="giftCardName"></span>!</h2>
            <p>Scan QR code di bawah ini</p>
            <img id="qrCodeImg" alt="QR Code Hadiah" style="width: 180px; height: 180px; margin: 15px auto; border-radius: 10px; border: 10px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
            <p>Semoga harimu menyenangkan!</p>
        </div>
    </div>
    <div class="feedback-modal" id="successModal">
        <div class="feedback-content">
            <div class="icon-container">
                <div class="loader"></div>
                <i class="fas fa-check-circle icon success hidden"></i>
            </div>
            <h2>Login Berhasil!</h2>
            <p>Mempersiapkan kejutan...</p>
        </div>
    </div>
    <div class="feedback-modal" id="failureModal">
        <div class="feedback-content">
            <div class="icon-container">
                <div class="loader"></div>
                <i class="fas fa-times-circle icon failure hidden"></i>
            </div>
            <h2 id="failure-title">Login Gagal!</h2>
            <p id="failure-message">Coba cek lagi...</p>
        </div>
    </div>
    
    <script>
        // Firebase Configuration - GANTI DENGAN KONFIGURASI ANDA
        const firebaseConfig = {
            apiKey: "AIzaSyCWl2CJqIr-u8lSHu8s4tgZ25UQIK2ivt0",
            authDomain: "mayfa-fa284.firebaseapp.com",
            databaseURL: "https://mayfa-fa284-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mayfa-fa284",
            storageBucket: "mayfa-fa284.firebasestorage.app",
            messagingSenderId: "523290705179",
            appId: "1:523290705179:web:b06ae4d8e6b08cf07b27be"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let GUEST_USER = "user";
        let GUEST_PASS = "user";
        let BIRTHDAY_NAME = "Mayfa";
        let BIRTH_DATE = "2005-09-28";
        let QR_IMAGE_URL = "";

        // Load settings from Firebase
        database.ref('settings').on('value', (snapshot) => {
            const settings = snapshot.val();
            if (settings) {
                GUEST_USER = settings.guestUser || "user";
                GUEST_PASS = settings.guestPass || "user";
                BIRTHDAY_NAME = settings.birthdayName || "Mayfa";
                BIRTH_DATE = settings.birthDate || "2005-09-28";
                QR_IMAGE_URL = settings.qrImageUrl || "";
                
                // Update UI if birthday page is visible
                if (document.getElementById('birthdayName')) {
                    document.getElementById('birthdayName').textContent = BIRTHDAY_NAME + "!";
                    calculateAndDisplayAge(BIRTH_DATE);
                }
            }
        });

        const loginContainer = document.getElementById("loginContainer");
        const loginBox = document.getElementById("loginBox");
        const birthdayPage = document.getElementById("birthdayPage");
        const giftModal = document.getElementById("giftModal");
        const giftBox = document.querySelector(".gift-box");
        const giftCard = document.getElementById("giftCard");
        const backgroundMusic = document.getElementById("background-music");
        const togglePassword = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        const successModal = document.getElementById("successModal");
        const successLoader = successModal.querySelector(".loader");
        const successIcon = successModal.querySelector(".icon.success");
        const failureModal = document.getElementById("failureModal");
        const failureLoader = failureModal.querySelector(".loader");
        const failureIcon = failureModal.querySelector(".icon.failure");
        const failureTitle = failureModal.querySelector("#failure-title");
        const failureMessage = failureModal.querySelector("#failure-message");
        
        let fireworksInterval, driftingConfettiInterval;
        
        // Modern login animation
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                loginBox.style.transform = 'scale(1)';
                loginBox.style.opacity = '1';
            }, 100);
            
            // Floating particles for login background
            setInterval(() => {
                createDriftingParticle();
            }, 300);
        });
        
        togglePassword.addEventListener("click", function() {
            this.classList.add("icon-toggle-animation");
            const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
            passwordInput.setAttribute("type", type);
            this.classList.toggle("fa-eye");
            this.classList.toggle("fa-eye-slash");
            
            this.addEventListener("animationend", () => {
                this.classList.remove("icon-toggle-animation");
            }, { once: true });
        });
        
        function calculateAndDisplayAge(birthDate) {
            const birthDateObj = new Date(birthDate);
            const today = new Date();
            let age = today.getFullYear() - birthDateObj.getFullYear();
            const monthDiff = today.getMonth() - birthDateObj.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDateObj.getDate())) {
                age--;
            }
            
            document.getElementById("ageDisplay").innerText = `Hari ini usiamu genap ${age} tahun. Selamat!`;
        }
        
        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            
            if (username === GUEST_USER && password === GUEST_PASS) {
                // Login success animation
                loginBox.style.transform = 'translateY(-20px) rotateY(20deg)';
                loginBox.style.boxShadow = '0 25px 50px rgba(0, 0, 0, 0.3)';
                
                successLoader.classList.remove("hidden");
                successIcon.classList.add("hidden");
                successModal.style.display = "flex";
                
                setTimeout(() => {
                    loginBox.style.transform = 'translateY(40px) rotateY(-90deg) scale(0.8)';
                    loginBox.style.opacity = '0';
                    
                    setTimeout(() => {
                        successLoader.classList.add("hidden");
                        successIcon.classList.remove("hidden");
                        
                        setTimeout(() => {
                            successModal.style.display = "none";
                            loginBox.classList.add("hidden");
                            
                            setTimeout(() => {
                                loginContainer.style.display = "none";
                                birthdayPage.style.display = "flex";
                                document.body.classList.remove("no-scroll");
                                
                                try {
                                    backgroundMusic.play().catch(e => {
                                        console.log("Autoplay gagal: ", e);
                                    });
                                } catch (e) {
                                    console.log("Autoplay error: ", e);
                                }
                                
                                document.getElementById("birthdayName").textContent = BIRTHDAY_NAME + "!";
                                calculateAndDisplayAge(BIRTH_DATE);
                                startDriftingConfetti();
                                createBalloons(15);
                            }, 500);
                        }, 1000);
                    }, 1500);
                }, 300);
            } else {
                // Login failure animation
                loginBox.animate([
                    { transform: 'translateX(0px)', easing: 'ease-in' },
                    { transform: 'translateX(-15px)', easing: 'ease-out' },
                    { transform: 'translateX(15px)', easing: 'ease-in' },
                    { transform: 'translateX(0px)', easing: 'ease-out' }
                ], {
                    duration: 600,
                    iterations: 1
                });
                
                failureLoader.classList.remove("hidden");
                failureIcon.classList.add("hidden");
                failureTitle.textContent = "Mengecek...";
                failureMessage.textContent = "Memverifikasi username & password.";
                failureModal.style.display = "flex";
                
                setTimeout(() => {
                    failureLoader.classList.add("hidden");
                    failureIcon.classList.remove("hidden");
                    failureTitle.textContent = "Login Gagal!";
                    failureMessage.textContent = "Silakan coba lagi.";
                    
                    setTimeout(() => {
                        failureModal.style.display = "none";
                    }, 1500);
                }, 1500);
            }
        }
        
        function createBalloons(count) {
            const colors = [
                '#FF6B6B', '#FF8E53', '#4ECDC4', '#6A11CB', 
                '#2575FC', '#FFD166', '#EF476F', '#118AB2'
            ];
            
            for (let i = 0; i < count; i++) {
                const balloon = document.createElement('div');
                balloon.classList.add('balloon');
                
                // Random size between 60px and 100px
                const size = Math.random() * 40 + 60;
                balloon.style.width = `${size}px`;
                balloon.style.height = `${size * 1.1}px`;
                balloon.style.left = `${Math.random() * 100}%`;
                
                // Random color
                const color = colors[Math.floor(Math.random() * colors.length)];
                balloon.style.setProperty('--color', color);
                
                // Random animation duration
                const duration = Math.random() * 15 + 20;
                balloon.style.animationDuration = `${duration}s`;
                balloon.style.animationDelay = `${Math.random() * 2}s`;
                
                // Create balloon body
                const balloonBody = document.createElement('div');
                balloonBody.classList.add('balloon-body');
                
                // Create highlight
                const highlight = document.createElement('div');
                highlight.classList.add('balloon-highlight');
                
                // Create string
                const string = document.createElement('div');
                string.classList.add('balloon-string');
                
                // Create knot
                const knot = document.createElement('div');
                knot.classList.add('balloon-knot');
                
                // Assemble balloon
                balloonBody.appendChild(highlight);
                balloon.appendChild(balloonBody);
                balloon.appendChild(string);
                balloon.appendChild(knot);
                
                document.body.appendChild(balloon);
                
                // Create confetti when balloon pops
                setTimeout(() => {
                    createConfetti(balloon.offsetLeft + size/2, balloon.offsetTop + size/2, color);
                    balloon.remove();
                }, duration * 1000);
            }
            
            // Create floating confetti
            createConfettiFall();
        }
        
        // Create confetti explosion
        function createConfetti(x, y, color) {
            for (let i = 0; i < 25; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.setProperty('--color', color);
                confetti.style.left = `${x}px`;
                confetti.style.top = `${y}px`;
                
                // Random size
                const size = Math.random() * 8 + 4;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                
                // Random animation
                const duration = Math.random() * 2 + 1;
                confetti.style.animationDuration = `${duration}s`;
                
                // Random direction
                confetti.style.setProperty('--x', (Math.random() - 0.5) * 200);
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, duration * 1000);
            }
        }
        
        // Create falling confetti
        function createConfettiFall() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.setProperty('--color', [
                        '#FF6B6B', '#FF8E53', '#4ECDC4', '#6A11CB', 
                        '#2575FC', '#FFD166', '#EF476F', '#118AB2'
                    ][Math.floor(Math.random() * 8)]);
                    confetti.style.left = `${Math.random() * 100}%`;
                    
                    // Random size
                    const size = Math.random() * 10 + 5;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    
                    // Random animation
                    const duration = Math.random() * 5 + 5;
                    confetti.style.animationDuration = `${duration}s`;
                    confetti.style.opacity = Math.random() * 0.5 + 0.5;
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, duration * 1000);
                }, i * 200);
            }
        }
        
        function createDriftingParticle() {
            const particle = document.createElement("div");
            particle.className = "drifting-particle";
            document.body.appendChild(particle);
            
            const size = Math.random() * 5 + 3;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.background = ["#ff6b6b", "#ffd166", "#4ecdc4", "#ffffff"][Math.floor(Math.random() * 4)];
            particle.style.left = Math.random() * 100 + "vw";
            
            const duration = Math.random() * 5000 + 5000;
            const xOffset = 200 * (Math.random() - 0.5);
            const rotation = 720 * Math.random();
            
            particle.animate([
                { transform: "translate(0, 0) rotate(0deg)", opacity: 1 },
                { transform: `translate(${xOffset}px, 105vh) rotate(${rotation}deg)`, opacity: 0 }
            ], {
                duration: duration,
                easing: "linear"
            }).onfinish = () => particle.remove();
        }
        
        function startDriftingConfetti() {
            if (driftingConfettiInterval) clearInterval(driftingConfettiInterval);
            driftingConfettiInterval = setInterval(createDriftingParticle, 200);
        }
        
        function createParticle(x, y) {
            const particle = document.createElement("div");
            particle.classList.add("particle");
            document.body.appendChild(particle);
            
            const size = Math.floor(Math.random() * 7 + 5);
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.background = ["#ff6b6b", "#ff8e53", "#6a11cb", "#2575fc", "#4ecdc4", "#ffd166", "#fff"][Math.floor(Math.random() * 7)];
            
            const xOffset = 400 * (Math.random() - 0.5);
            const yOffset = 400 * (Math.random() - 0.5);
            const duration = Math.random() * 800 + 700;
            
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            
            particle.animate([
                { transform: "translate(0, 0)", opacity: 1 },
                { transform: `translate(${xOffset}px, ${yOffset}px)`, opacity: 0 }
            ], {
                duration: duration,
                easing: "cubic-bezier(0.1, 0.7, 1.0, 0.1)"
            }).onfinish = () => particle.remove();
        }
        
        function createFireworkExplosion() {
            const x = window.innerWidth * 0.6 * (0.2 + Math.random());
            const y = window.innerHeight * 0.6 * (0.2 + Math.random());
            
            for (let i = 0; i < 30; i++) {
                createParticle(x, y);
            }
        }
        
        function startFireworks() {
            if (fireworksInterval) clearInterval(fireworksInterval);
            fireworksInterval = setInterval(createFireworkExplosion, 400);
        }
        
        function stopFireworks() {
            clearInterval(fireworksInterval);
        }
        
        function openGift() {
            giftModal.style.display = "flex";
        }
        
        function openCard() {
            giftBox.style.display = "none";
            giftCard.style.display = "block";
            document.getElementById("giftCardName").textContent = BIRTHDAY_NAME;
            
            const qrImg = document.getElementById("qrCodeImg");
            
            // Menggunakan QR code dari URL yang disimpan di Firebase
            if (QR_IMAGE_URL) {
                qrImg.src = QR_IMAGE_URL;
                qrImg.style.border = "10px solid white";
                qrImg.style.boxShadow = "0 5px 15px rgba(0,0,0,0.2)";
            } else {
                // Fallback ke QR code generator jika tidak ada gambar yang diunggah
                let qrData = `Selamat Ulang Tahun ${BIRTHDAY_NAME}!`;
                const encodedData = encodeURIComponent(qrData);
                qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodedData}`;
            }
            
            startFireworks();
        }
        
        function closeGiftModal() {
            giftModal.style.display = "none";
            giftCard.style.display = "none";
            giftBox.style.display = "block";
            stopFireworks();
        }
        
        giftModal.addEventListener("click", e => {
            if (e.target === giftModal) {
                closeGiftModal();
            }
        });
        
        // Initialize
        document.addEventListener("DOMContentLoaded", () => {
            document.body.classList.add("no-scroll");
            birthdayPage.style.display = "none";
            giftModal.style.display = "none";
            
            // Initial login box state for animation
            loginBox.style.transform = 'scale(0.9) rotateY(30deg)';
            loginBox.style.opacity = '0';
            
            document.body.addEventListener("click", () => {
                backgroundMusic.play();
            }, { once: true });
        });
    </script>
</body>
</html>
